<!-- index.html  (allâ€‘inâ€‘one, now with bottomâ€‘left logo)  -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Game Recommendation Search</title>

  <!-- ðŸ’…  Minimal inâ€‘page styles  -->
  <style>
    :root { --accent:#3b82f6; }
    *{box-sizing:border-box}
    body{margin:0;height:100vh;display:flex;justify-content:center;align-items:center;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;background:#f3f4f6}

    /* Search container */
    .search-wrapper{position:relative;width:min(90%,480px)}
    /* Rounded text bar */
    #searchInput{width:100%;padding:.9rem 1.15rem;font-size:1rem;border-radius:9999px;border:none;outline:none;box-shadow:0 4px 14px rgba(0,0,0,.1)}

    /* Suggestions dropdown */
    #suggestions{list-style:none;margin:0;padding:.25rem 0;position:absolute;top:100%;left:0;right:0;max-height:260px;overflow-y:auto;background:#fff;border-radius:1rem;box-shadow:0 8px 20px rgba(0,0,0,.08);display:none;z-index:10;font-size:.95rem}
    #suggestions li{padding:.6rem 1rem;cursor:pointer}
    #suggestions li:hover{background:#f1f5f9}
    #suggestions li.heading{font-size:.7rem;font-weight:600;text-transform:uppercase;background:#f9fafb;cursor:default}
    #suggestions li.disabled{color:#9ca3af;pointer-events:none}
    #suggestions .match{color:var(--accent);font-weight:600}

    /* Top banner */
    #banner{position:fixed;top:-100px;left:50%;transform:translateX(-50%);padding:.75rem 1.5rem;border-radius:0 0 1rem 1rem;font-weight:500;transition:top .35s ease;z-index:50;text-align:center}
    #banner.success{background:#ecfdf5;color:#059669}
    #banner.warn{background:#fefce8;color:#b45309}
    #banner.error{background:#fef2f2;color:#b91c1c}
    #banner.info{background:#e0f2fe;color:#0369a1}
    #banner a{text-decoration:underline;margin-left:.25rem}

    /* ðŸ”°  Bottomâ€‘left logo  */
    #siteLogo{
      position:fixed;bottom:20px;left:20px;z-index:40;
      /* responsive size: between 120â€¯px and 250â€¯px, 18â€¯vw is midâ€‘sized desktop */
      width:clamp(120px,18vw,250px);
      height:auto;user-select:none;pointer-events:none;
    }

    #pageTitle{
      margin:0 0 1.25rem 0;
      font-size:1.65rem;
      font-weight:700;
      color:#111827;
      line-height:1.15;
    }
  </style>
</head>
<body>
  <!-- Feedback banner -->
  <div id="banner"></div>
  <!-- ðŸ”  Search widget (title + input) -->
  <div class="search-wrapper">
    <center><h1 id="pageTitle">Catâ€‘Nitro Game Recommendations</h1></center>
    <form id="searchForm" autocomplete="off">
      <input type="text" id="searchInput" placeholder="Submit A" />
    </form>
    <ul id="suggestions"></ul>
  </div>

  <!-- ðŸ·ï¸  Bottomâ€‘left logo (replace src with your file) -->
  <img id="siteLogo" src="/assets/img/developed-by-cat_nitro-team1.png" alt="Watermark: Developed by the cat-nitro team. Fun For All." />

  <!-- ðŸ§   Core logic  -->
  <script>
  /************ 1. Data ************/
  const ALL_GAMES = [
    "1v1lol","10 Minutes Till Dawn","99 Balls","100 Player Pong","2048","Achievement Unlocked","A Dark Room","Ages Of Conflict","Amazing Rope Police","Arcade Wizard","Avalanche","Awesome Tanks 2","Backrooms","Baldis Basics","Baldis Basics Camping","Basket Random","Bitlife","Boxing Random","Burger And Frights","Chrome Dino","CirclO","City Car Stunt Master","Connect 3","Cookie Clicker","Core Ball","CrossyRoad","CS:GO Clicker","Cut the Rope","Cut the Rope Holiday","Cut the Rope Time Travel","Cubefield","Dante","Death Car IO","Deepest Sword","Death Run 3D","Doge Miner","Drangon VS Bricks","Drive Mad","Duck Life 1","Duck Life 4","Edge Surf","Epic Tower Defense","Evil Glitch","Evolution","Exo","Fair Squares","Flappy Bird","Flash Tetris","Fruit Ninja","Game Inside a Game","Geometry Dash (Scratch)","Getting Over It (Scratch)","Go Ball","Google Feud","Half Life 1","Helios","Hover Bot Arena","Hextris","House Of Hazards","Interactive Buddy","Jetpack Joyride","Just Fall","Kitchen Gun Game","Madalin Stunt Cars 3","Mario","Minecraft Classic","Mini-putt","Monkeh Mart","Monster Tracks","n-gon","Ninja Dash","Pacman 3D","Pandemic 2","Paper.io 2","Particle Clicker","Pixel Gun Survival","Polygon Fusion","Portal (Flash)","Retro Bowl","Rolly Vortex","Roof-Top Sniperz","Sand Game","Sandboxels","Santy Is Home","Scrap Metal","Slope","Snow Rider","Snowbattle","Soccer Random","Space Company","Space Garden","Stack","Station 141","Stick Duel Battle","Stickman Hook","Subway Surfers","Super Tic-Tac-Toe","Super Mario 64","Swerve","Tank Trouble 2","Tanuki Sunset","Temple Run 2","The Bowling Club","This Is The Only Level","Time Shooter 3: SWAT","Twitch Tetris","Unfair Mario","Volley Random","Wall Smash","Yohoho.io"
  ];
  const BLACKLIST = [...ALL_GAMES];

  /************ 2. DOM refs ************/
  const inputEl   = document.getElementById('searchInput');
  const formEl    = document.getElementById('searchForm');
  const sugListEl = document.getElementById('suggestions');
  const bannerEl  = document.getElementById('banner');

  /************ 3. Autocomplete ************/
  inputEl.addEventListener('input', () => renderAutocomplete(inputEl.value));
  document.addEventListener('click', e => {
    if (!e.target.closest('.search-wrapper')) sugListEl.style.display = 'none';
  });

  function highlight(text, query){
    const i = text.toLowerCase().indexOf(query.toLowerCase());
    if (i === -1) return text;
    return text.substring(0,i) + '<span class="match">' + text.substr(i, query.length) + '</span>' + text.substring(i+query.length);
  }

  function renderAutocomplete(query){
    const q = query.trim().toLowerCase();
    if(!q){sugListEl.style.display='none';return;}

    const blkMatches = BLACKLIST.filter(g=>g.toLowerCase().startsWith(q)).slice(0,10);
    const newMatches = ALL_GAMES.filter(g=>g.toLowerCase().startsWith(q) && !blkMatches.includes(g)).slice(0,10);

    const items = [];
    if(blkMatches.length){
      items.push('<li class="heading">Games Already Included</li>');
      blkMatches.forEach(t=>items.push('<li class="disabled">'+highlight(t,q)+'</li>'));
    }
    if(newMatches.length){
      items.push('<li class="heading">Suggestions</li>');
      newMatches.forEach(t=>items.push('<li>'+highlight(t,q)+'</li>'));
    }

    sugListEl.innerHTML = items.join('');
    sugListEl.style.display = items.length? 'block':'none';
  }

  // click on suggestion (but ignore headings / disabled)
  sugListEl.addEventListener('click', e=>{
    const li = e.target.closest('li');
    if(!li || li.classList.contains('heading') || li.classList.contains('disabled')) return;
    inputEl.value = li.textContent;
    formEl.requestSubmit();
  });

  /************ 4. Form submission ************/
  formEl.addEventListener('submit', async e=>{
    e.preventDefault();
    const title = inputEl.value.trim();
    if(!title) return;

    // 4.1  Already on site?  ðŸ‘‰ reject locally
    if(BLACKLIST.some(g=>g.toLowerCase()===title.toLowerCase())){
      showBanner('"'+title+'" is already on the site.', 'info');
      console.log('[Filter] Skipped â€“ title already present');
      return;
    }

    // 4.2  GPT classification
    const verdict = await checkWithOpenAI(title);
    if(verdict==='OK'){
      showBanner('"'+title+'" accepted!', 'success');
      await window.pushToFirebase(title);
      inputEl.value='';
      renderAutocomplete('');
    }else if(['A','B','C'].includes(verdict)){
      const msgMap={A:'was flagged as spam.',B:'was deemed inappropriate.',C:"isn't feasible as a browser game."};
      showBanner('"'+title+'" '+msgMap[verdict]+' <a href="https://forms.gle/rLt9Vm1n9632ze2dA" target="_blank">Learn more</a>', verdict==='A'?'warn':'error');
    }else{
      // error fallback already handled inside checkWithOpenAI
    }
  });

  async function checkWithOpenAI(title){
    try{
      const res = await fetch('https://api.openai.com/v1/chat/completions',{
        method:'POST',
        headers:{'Content-Type':'application/json','Authorization':`Bearer ${OPENAI_API_KEY}`},
        body:JSON.stringify({
          model:OPENAI_MODEL,
          messages:[{role:'user',content:`Classify \"${title}\" as A (spam), B (inappropriate), C (unfeasible) or OK.`}],
          max_tokens:1,temperature:0
        })
      });
      const data = await res.json();
      const letter = data.choices?.[0]?.message?.content?.trim().charAt(0);
      console.log('[GPT-Filter] request â†’', title, '\nverdict â†', letter);
      return ['A','B','C'].includes(letter)?letter:'OK';
    }catch(err){
      console.error(err);
      showBanner('OpenAI request failed â€“ retry later.','error');
      return 'ERR';
    }
  }

  /************ 5. UI helpers ************/
  function showBanner(text, type='success'){
    bannerEl.innerHTML=text;
    bannerEl.className=type;
    bannerEl.style.top='0';
    clearTimeout(showBanner._t);
    showBanner._t=setTimeout(()=>bannerEl.style.top='-100px',4000);
  }
  </script>
  <a></a>

  <!-- ðŸ”‘  Config & SDKs (replace placeholders) -->
  <script>
    // OpenAI (put your real key in an env var for prod!)
    const OPENAI_API_KEY = atob('QUl6YVN5QW51c0FZNXBkMnV3RWg1QTNVVXhNQmcwNUZEUlhrSndF');
    const OPENAI_MODEL   = "gpt-3.5"
    </script>